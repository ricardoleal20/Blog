<!DOCTYPE html>
<html lang="en">
  <div id="particles-js"></div>
  <script type="text/javascript" src="https://ricardoleal20.github.io/Blog/js/app.js"></script>
  <script type="text/javascript" src="https://ricardoleal20.github.io/Blog/js/particles.js"></script>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    

    <meta name="author" content="Ricardo M. Leal Lopez">
    <meta name="description" content="Solve some ODEs and optimize the system.">
    <meta name="keywords" content="Programmer, Physicist">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Optimization of a snow ball problem."/>
<meta name="twitter:description" content="Solve some ODEs and optimize the system."/>

    <meta property="og:title" content="Optimization of a snow ball problem." />
<meta property="og:description" content="Solve some ODEs and optimize the system." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ricardoleal20.github.io/Blog/posts/snowball/snowball/" />
<meta property="article:published_time" content="2021-04-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-07T00:00:00+00:00" /><meta property="og:see_also" content="https://ricardoleal20.github.io/Blog/posts/new-traffic/traffic/" /><meta property="og:see_also" content="https://ricardoleal20.github.io/Blog/posts/heat_1d/heat_1d/" /><meta property="og:see_also" content="https://ricardoleal20.github.io/Blog/posts/epidemic/epidemic/" /><meta property="og:see_also" content="https://ricardoleal20.github.io/Blog/posts/wave_membrane/wave_membrane/" /><meta property="og:see_also" content="https://ricardoleal20.github.io/Blog/posts/traffic-flow/traffic-flow/" />



    <title>
  Optimization of a snow ball problem. · Ricardo
</title>

    
      <link rel="canonical" href="https://ricardoleal20.github.io/Blog/posts/snowball/snowball/">
    

    <link rel="preload" href="https://ricardoleal20.github.io/Blog/fonts/forkawesome-webfont.woff2?v=1.1.7" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="https://ricardoleal20.github.io/Blog/css/coder.min.ec198d25949ddd79a670b1ead43ca88e0bc2c1343266d0df0a9eeb7f3f207777.css" integrity="sha256-7BmNJZSd3XmmcLHq1DyojgvCwTQyZtDfCp7rfz8gd3c=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://ricardoleal20.github.io/Blog/css/coder-dark.min.89c82b6022b96f77aeb521b240daec4f87ea029d84d1c78b8acd0735b91b3c92.css" integrity="sha256-icgrYCK5b3eutSGyQNrsT4fqAp2E0ceLis0HNbkbPJI=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="https://ricardoleal20.github.io/Blog/css/style.css" />
    

    

    <link rel="icon" type="image/png" href="https://ricardoleal20.github.io/Blog/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://ricardoleal20.github.io/Blog/img/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="https://ricardoleal20.github.io/Blog/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://ricardoleal20.github.io/Blog/images/apple-touch-icon.png">

    
      <script defer src="https://twemoji.maxcdn.com/v/13.0.1/twemoji.min.js"
        integrity="sha384-5f4X0lBluNY/Ib4VhGx0Pf6iDCF99VGXJIyYy7dDLY5QlEd7Ap0hICSSZA1XYbc4" crossorigin="anonymous"></script>
    

    <meta name="generator" content="Hugo 0.80.0" />
  </head>

  
  
    
  
  <body class="colorscheme-dark"
        onload=" twemoji.parse(document.body); "
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://ricardoleal20.github.io/Blog/">
      Ricardo
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://ricardoleal20.github.io/Blog/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://ricardoleal20.github.io/Blog/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://ricardoleal20.github.io/Blog/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://ricardoleal20.github.io/Blog/contact/">Contact me</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://ricardoleal20.github.io/Blog/es/posts/snowball/snowball/">Español</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>

      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://ricardoleal20.github.io/Blog/posts/snowball/snowball/">
              Optimization of a snow ball problem.
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2021-04-07T00:00:00Z'>
                April 7, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="https://ricardoleal20.github.io/Blog/categories/python/">Python</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <a href="https://ricardoleal20.github.io/Blog/tags/numerical-methods/">Numerical Methods</a>
      <span class="separator">•</span>
    <a href="https://ricardoleal20.github.io/Blog/tags/python/">Python</a>
      <span class="separator">•</span>
    <a href="https://ricardoleal20.github.io/Blog/tags/optimization/">Optimization</a></div>

        </div>
      </header>

      <div>
        
        <h1 id="snowball-rolling">
  Snowball Rolling
  <a class="heading-link" href="#snowball-rolling">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Suppose that we had a inclinated plane with a snowball in the higher zone. At the end onf that plane, there is a tree that requires a force of $25000N$ to get broke. The equations for the dynamics moves of the snowball are:</p>
<p>\begin{equation}
\Large\begin{array}{c}
\frac{dm}{dt}=\beta K_0e^{-\beta t} \\<br>
\frac{dr}{dt}=\frac{\beta K_0e^{-\beta t}}{4\pi\rho r^2} \\<br>
\frac{dx}{dt}=v \\<br>
\frac{dv}{dt}=-\frac{15\rho_aC_d}{56\rho}\frac{v^2}{r}-\frac{23v}{7r}\frac{\beta K_0e^{-\beta t}}{4\pi\rho r^2}+\frac{5}{7}gsin(\theta)
\end{array}
\end{equation}</p>
<p>While the impact force is $F=\frac{K_E}{r}$, where $K_E$ is the kinetic energy. That equation is:</p>
<p>\begin{equation}
K_E=\frac{1}{2}mv^2
\end{equation}</p>
<p>If we had the following values</p>
<ul>
<li>$K_0=85$ where $k$ is on the growth factor of the snowball</li>
<li>$\beta=0.07$ where $\beta$ is the second growth factor.</li>
<li>$C_d=0.3$ where $C_d$ is the drag coefficient.</li>
<li>$\rho=350$ where is the snow density.</li>
<li>$\theta=5°$ and is the inclination of the plane.</li>
<li>$\rho_a=0.9$ and is the air density.</li>
<li>$m_0=10$ and it&rsquo;s the initial mass.</li>
</ul>
<p>Solve the equation for the first $t=30s$ and check the impact force. The snowball will can broke the tree?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f00">import</span> numpy <span style="color:#f00">as</span> np
<span style="color:#f00">import</span> pandas <span style="color:#f00">as</span> pd
<span style="color:#f00">import</span> matplotlib.pyplot <span style="color:#f00">as</span> plt
<span style="color:#f00">from</span> matplotlib.animation <span style="color:#f00">import</span> FuncAnimation
<span style="color:#f00">from</span> scipy.optimize <span style="color:#f00">import</span> minimize
<span style="color:#f00">from</span> numba <span style="color:#f00">import</span> njit
<span style="color:#f00">from</span> jupyterthemes <span style="color:#f00">import</span> jtplot
jtplot.style(theme=<span style="color:#87ceeb">&#39;monokai&#39;</span>)
</code></pre></div><p>Create the variables to use.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0f0">#---------------#</span>
<span style="color:#0f0"># Variables     #</span>
<span style="color:#0f0">#---------------#</span>

K0=<span style="color:#f60">85</span>     <span style="color:#0f0">#Growth factor 1</span>
beta=<span style="color:#f60">0.07</span> <span style="color:#0f0">#Growth factor 2</span>
Cd=<span style="color:#f60">0.3</span>    <span style="color:#0f0">#Drag coefficient</span>
rho=<span style="color:#f60">350</span>   <span style="color:#0f0">#Snow density</span>
rho_a=<span style="color:#f60">0.9</span> <span style="color:#0f0">#Air density</span>
g=<span style="color:#f60">9.8</span>     <span style="color:#0f0">#Gravity</span>
theta=np.radians(<span style="color:#f60">5</span>)  <span style="color:#0f0">#Theta of the plane</span>
m0=<span style="color:#f60">10</span>     <span style="color:#0f0">#initial mass of the snowball</span>
r0=(<span style="color:#f60">3</span>*m0/(<span style="color:#f60">4</span>*np.pi*rho))**(<span style="color:#f60">1</span>/<span style="color:#f60">3</span>) <span style="color:#0f0">#initial radius of the snowball</span>
x0=<span style="color:#f60">0</span>      <span style="color:#0f0">#Initial position</span>
v0=<span style="color:#f60">0</span>      <span style="color:#0f0">#initial velocity</span>
tf=<span style="color:#f60">30</span>     <span style="color:#0f0">#Total time of simulation</span>
N=<span style="color:#f60">301</span>     <span style="color:#0f0">#Grid points</span>
dt=(tf)/(N-<span style="color:#f60">1</span>) <span style="color:#0f0">#Timestep</span>
t=np.linspace(<span style="color:#f60">0</span>,tf,N) <span style="color:#0f0">#Time array</span>
</code></pre></div><p>The first thing that you need to do is discretize the equations. For this PDE solutions, i&rsquo;m going to use Runge-Kutta. This method had a error of $O(h^4)$ so it&rsquo;s really approximate to the real solution. This method consist on solve 4 different values of $K_n$ and with that, solve for $x_{i+1}$. That four $K_n$ are:</p>
<p>\begin{equation}
\large\begin{array}{c}
K_1=hf(t_n,x_n) \\<br>
K_2=hf(t_n+\frac{h}{2},x_n+\frac{K_1}{2}) \\<br>
K_3=hf(t_n+\frac{h}{2},x_n+\frac{K_2}{2}) \\<br>
K_4=hf(t_n+h,x_n+K_3 )
\end{array}
\end{equation}</p>
<p>But, what is $f(t_n,x_n)$? Well, suppose that you had a ODE like this $\frac{dx}{dt}=x+t$. In this case, the function is $f(t_n,x_n)=x_n+t_n$. Once the function is $f(t_n+h,x_n+h)$ you will have $(x_n+h)+(t_n+h)$. In this case, $h$ is $\Delta t$.</p>
<p>Once that all that $K$ are evaluated, I can evaluate $x_{n+1}$.</p>
<p>\begin{equation}
x_{n+1}=x_n+\frac{k_1}{6}+\frac{k_2}{3}+\frac{k_3}{3}+\frac{k_4}{6}
\end{equation}</p>
<p>It&rsquo;s easy! You can create four different functions that solve Runge Kutta for every PDE. Let&rsquo;s take a look</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0f0">#Function of dm/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">f1</span>(t,beta,K0,rho):
    <span style="color:#0f0">#global beta, K0, rho</span>
    <span style="color:#f00">return</span> beta*K0*np.exp(-beta*t)

<span style="color:#0f0">#Function of dr/dt</span>

<span style="color:#f00">def</span> <span style="color:#ff0">f2</span>(t,r,beta,K0,rho):
    <span style="color:#0f0">#global beta, K0, rho</span>
    <span style="color:#f00">return</span> beta*K0*np.exp(-beta*t)/(<span style="color:#f60">4</span>*np.pi*rho*r**<span style="color:#f60">2</span>)

<span style="color:#0f0">#Function of dx/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">f3</span>(v):
    <span style="color:#f00">return</span> v

<span style="color:#0f0">#Funciton of dv/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">f4</span>(t,v,r,beta,K0,rho,rho_a,Cd,g,theta):
    <span style="color:#0f0">#global beta, K0, rho, rho_a, Cd, g, theta</span>
    T1=-<span style="color:#f60">15</span>*rho_a*Cd/(<span style="color:#f60">56</span>*rho)*(v**<span style="color:#f60">2</span>/r)
    T2=-<span style="color:#f60">23</span>*v/(<span style="color:#f60">7</span>*r)*(beta*K0*np.exp(-beta*t))/(<span style="color:#f60">4</span>*np.pi*rho*r**<span style="color:#f60">2</span>)
    T3=<span style="color:#f60">5</span>/<span style="color:#f60">7</span>*g*np.sin(theta)
    <span style="color:#f00">return</span> T1+T2+T3
</code></pre></div><p>Now, create the functions to calculate Runge-Kutta to every ODE</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0f0">#Runge Kutta for dm/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">runge_kuta_m</span>(dt,m,t,beta,K0,rho):
    k1=dt*f1(t,beta,K0,rho)
    k2=dt*f1(t+dt/<span style="color:#f60">2</span>,beta,K0,rho)
    k3=dt*f1(t+dt/<span style="color:#f60">2</span>,beta,K0,rho)
    k4=dt*f1(t+dt,beta,K0,rho)
    sol=m+k1/<span style="color:#f60">6</span>+k2/<span style="color:#f60">3</span>+k3/<span style="color:#f60">3</span>+k4/<span style="color:#f60">6</span>
    <span style="color:#f00">return</span> sol

<span style="color:#0f0">#Runge Kutta for dr/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">runge_kuta_r</span>(dt,r,t,beta, K0, rho):
    k1=dt*f2(t,r,beta,K0,rho)
    k2=dt*f2(t+dt/<span style="color:#f60">2</span>,r+k1/<span style="color:#f60">2</span>,beta,K0,rho)
    k3=dt*f2(t+dt/<span style="color:#f60">2</span>,r+k2/<span style="color:#f60">2</span>,beta,K0,rho)
    k4=dt*f2(t+dt,r+k3,beta,K0,rho)
    sol=r+k1/<span style="color:#f60">6</span>+k2/<span style="color:#f60">3</span>+k3/<span style="color:#f60">3</span>+k4/<span style="color:#f60">6</span>
    <span style="color:#f00">return</span> sol

<span style="color:#0f0">#Runge Kutta for dx/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">runge_kuta_x</span>(dt,x,v):
    k1=dt*f3(v)
    k2=dt*f3(v)
    k3=dt*f3(v)
    k4=dt*f3(v)
    sol=x+k1/<span style="color:#f60">6</span>+k2/<span style="color:#f60">3</span>+k3/<span style="color:#f60">3</span>+k4/<span style="color:#f60">6</span>
    <span style="color:#f00">return</span> sol

<span style="color:#0f0">#Runge Kutta for dv/dt</span>
<span style="color:#f00">def</span> <span style="color:#ff0">runge_kuta_v</span>(dt,v,t,r,beta,K0,rho,rho_a,Cd,g,theta):
    k1=dt*f4(t,v,r,beta, K0, rho, rho_a, Cd, g, theta)
    k2=dt*f4(t+dt/<span style="color:#f60">2</span>,v+k1/<span style="color:#f60">2</span>,r,beta, K0, rho, rho_a, Cd, g, theta)
    k3=dt*f4(t+dt/<span style="color:#f60">2</span>,v+k2/<span style="color:#f60">2</span>,r,beta, K0, rho, rho_a, Cd, g, theta)
    k4=dt*f4(t+dt,v+k3,r,beta, K0, rho, rho_a, Cd, g, theta)
    sol=v+k1/<span style="color:#f60">6</span>+k2/<span style="color:#f60">3</span>+k3/<span style="color:#f60">3</span>+k4/<span style="color:#f60">6</span>
    <span style="color:#f00">return</span> sol
</code></pre></div><p>Now, create a function that calculates the solution for all the ODEs. and also put the initial conditions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f00">def</span> <span style="color:#ff0">solution</span>(N,m0,r0,x0,v0,t,dt,beta,K0,rho,rho_a,Cd,g,theta):
    m,r,x,v=IC(N,m0,r0,x0,v0) <span style="color:#0f0">#Call the functions to creathe the matrix solutions</span>
    <span style="color:#0f0">#Now, performance the solution of the ODEs</span>
    <span style="color:#f00">for</span> i in range(N-<span style="color:#f60">1</span>):
        m[i+<span style="color:#f60">1</span>]=runge_kuta_m(dt,m[i],t[i],beta,K0,rho)
        r[i+<span style="color:#f60">1</span>]=runge_kuta_r(dt,r[i],t[i],beta,K0,rho)
        x[i+<span style="color:#f60">1</span>]=runge_kuta_x(dt,x[i],v[i])
        v[i+<span style="color:#f60">1</span>]=runge_kuta_v(dt,v[i],t[i],r[i],beta,K0,rho,rho_a,Cd,g,theta)
    <span style="color:#f00">return</span> m,r,x,v


<span style="color:#f00">def</span> <span style="color:#ff0">IC</span>(N,m0,r0,x0,v0):
    <span style="color:#0f0">#Create the matrix solution</span>
    m=np.zeros(N)
    r=np.zeros(N)
    x=np.zeros(N)
    v=np.zeros(N)
    <span style="color:#0f0">#Put the initial values</span>
    m[<span style="color:#f60">0</span>]=m0
    r[<span style="color:#f60">0</span>]=r0
    x[<span style="color:#f60">0</span>]=x0
    v[<span style="color:#f60">0</span>]=v0
    <span style="color:#f00">return</span> m,r,x,v
</code></pre></div><p>Solve the system</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">m,r,x,v=solution(N,m0,r0,x0,v0,t,dt,beta,K0,rho,rho_a,Cd,g,theta) <span style="color:#0f0">#Solve and save the results</span>

<span style="color:#0f0">#Kinetic Energy</span>
kE=<span style="color:#f60">0.5</span>*m*v**<span style="color:#f60">2</span>
<span style="color:#0f0">#Impact Force per time step</span>
F_i=kE/r
</code></pre></div><p>And now, let&rsquo;s see the plot of the results for $F_i$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f00">def</span> <span style="color:#ff0">plot</span>(t,F_i,N):
    fig,axs=plt.subplots(<span style="color:#f60">1</span>,figsize=(<span style="color:#f60">12</span>,<span style="color:#f60">5</span>))
    axs.plot(t,F_i,color=<span style="color:#87ceeb">&#39;teal&#39;</span>,marker=<span style="color:#87ceeb">&#39;o&#39;</span>,markevery=<span style="color:#f60">10</span>)
    axs.set_xlim(t[<span style="color:#f60">0</span>],t[N-<span style="color:#f60">1</span>])
    axs.spines[<span style="color:#87ceeb">&#39;right&#39;</span>].set_visible(False)
    axs.spines[<span style="color:#87ceeb">&#39;top&#39;</span>].set_visible(False)
    <span style="color:#0f0">#X label</span>
    axs.set_xlabel(<span style="color:#87ceeb">&#39;Time (s)&#39;</span>)
    <span style="color:#0f0">#Y label</span>
    axs.set_ylabel(<span style="color:#87ceeb">&#39;Impact force&#39;</span>)
    yticks=np.linspace(F_i[<span style="color:#f60">0</span>],F_i[N-<span style="color:#f60">1</span>],<span style="color:#f60">5</span>)
    axs.set_yticks(yticks)
    axs.set_yticklabels([<span style="color:#87ceeb">&#39;{0:.0f} N&#39;</span>.format(yticks[i]) <span style="color:#f00">for</span> i in range(len(yticks))])
    <span style="color:#f00">print</span>(<span style="color:#87ceeb">&#39;The final impact force is F={0:.02f} N&#39;</span>.format(F_i[N-<span style="color:#f60">1</span>]))

plot(t,F_i,N)
</code></pre></div><figure>
    <img src="https://ricardoleal20.github.io/Blog/images/snowball/F1.png"/> 
</figure>

<p>We have a problem, the snowball can&rsquo;t broke the tree at the end of the road. We can see that the $v_0$ and $x_0$ doesn&rsquo;t affect to much to our system, so what values of $m_0$ and $r_0$ do we need to broke the three? Well, you can know it using SciPy.</p>
<p>SciPy is great for scientific problems, they have functions to calculate a lot of thing like delta, and also have to many constants that Numpy and others libraries not. It works also for integrate and solve ODE, but in this case I only gonna use the optimization functions. I want to know what are the minimal value for $m_0$ (remembber, $r_0$ depends of $m_0$) to broke the tree in only 30s, keeping all the others variables like at the start. I&rsquo;m gonna use the function <em>minimize()</em> to do the task.</p>
<p><em>minimize()</em> requieres a function that calculate a value with one input. The function must return a value that need to aproach to $0$ to complete the minimization. Let&rsquo;s take a look at what I&rsquo;ve done</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f00">def</span> <span style="color:#ff0">optimization</span>(m0): 
    <span style="color:#f00">global</span> K0,beta,Cd,rho,rho_a,g,theta,x0,v0,dt,t,N
    <span style="color:#0f0">#I calculate r0 using m0</span>
    r0=(<span style="color:#f60">3</span>*m0/(<span style="color:#f60">4</span>*np.pi*rho))**(<span style="color:#f60">1</span>/<span style="color:#f60">3</span>)

    <span style="color:#0f0">#Now, i solve the system of ODE using r0 and m0</span>
    m,r,x,v=solution(N,m0,r0,x0,v0,t,dt,beta,K0,rho,rho_a,Cd,g,theta)

    <span style="color:#0f0">#Now, i calculate the kinetic energy and the Impact force. Like i&#39;m only interest in the final impact force, i&#39;m gonna use the last values of kE and F_i</span>
    <span style="color:#0f0">#Kinetic Energy</span>
    kE=<span style="color:#f60">0.5</span>*m[N-<span style="color:#f60">1</span>]*v[N-<span style="color:#f60">1</span>]**<span style="color:#f60">2</span>
    <span style="color:#0f0">#Impact Force per time step</span>
    F_i=kE/r[N-<span style="color:#f60">1</span>]

    <span style="color:#f00">return</span> abs(F_i-<span style="color:#f60">25000</span>) <span style="color:#0f0">#I create F_i-25000 because the tree needs a final impact force of 25000. When the value are close to 0, then i have the right m0 value</span>

<span style="color:#0f0">#Now, use the minimize function to solve the problem</span>
res= minimize(optimization,m0,method=<span style="color:#87ceeb">&#39;BFGS&#39;</span>,tol=<span style="color:#f60">1e-6</span>,options={<span style="color:#87ceeb">&#39;disp&#39;</span>:True})
<span style="color:#f00">print</span>(<span style="color:#87ceeb">&#39;</span><span style="color:#87ceeb">\n</span><span style="color:#87ceeb">&#39;</span>)

<span style="color:#0f0">#Now, get the optimize m0 and r0</span>
m0_opt=res.x[<span style="color:#f60">0</span>]
r0_opt=(<span style="color:#f60">3</span>*m0_opt/(<span style="color:#f60">4</span>*np.pi*rho))**(<span style="color:#f60">1</span>/<span style="color:#f60">3</span>)
<span style="color:#0f0">#Print the values</span>
<span style="color:#f00">print</span>(<span style="color:#87ceeb">&#39;&#39;&#39;The optimize initial mass is {f} kg
</span><span style="color:#87ceeb">The optimize initial radius is {d} m&#39;&#39;&#39;</span>.format(f=round(m0_opt,<span style="color:#f60">2</span>),d=round(r0_opt,<span style="color:#f60">2</span>)))


<span style="color:#0f0">#Solve the equations</span>
m,r,x,v=solution(N,m0_opt,r0_opt,x0,v0,t,dt,beta,K0,rho,rho_a,Cd,g,theta)

<span style="color:#0f0">#Kinetic Energy</span>
kE=<span style="color:#f60">0.5</span>*m*v**<span style="color:#f60">2</span>
<span style="color:#0f0">#Impact Force per time step</span>
F_i=kE/r

plot(t,F_i,N)
</code></pre></div><p>It only takes 2 iteratios to get the minimal value of $m_0$.</p>
<figure>
    <img src="https://ricardoleal20.github.io/Blog/images/snowball/F2.png"/> 
</figure>

<p>That&rsquo;s good! If the initial mass is $m_0=46.57kg$ then the snowball will broke the tree. And that&rsquo;s all! Now you know how to optimize some systems using SciPy. You can also check an animate plot to see how change the impact force for different $m_0$.</p>



<video width=100% controls autoplay>
    <source src="https://ricardoleal20.github.io/Blog/videos/snowball/Impact_Force.mp4" type="video/mp4">
    Your browser does not support the video tag.  
</video>



<p>That&rsquo;s all for this post! You can check the jupyter notebook from this problem <a href="https://github.com/ricardoleal20/Personal-Projects/blob/master/Python/Optimization/Snowball.ipynb">here</a>.</p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="see-also-in-python">
        See also in Python
        <a class="heading-link" href="#see-also-in-python">
          <i class="fa fa-link" aria-hidden="true"></i>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="https://ricardoleal20.github.io/Blog/posts/new-traffic/traffic/">Traffic flow with SciPy.</a>
            </li>
          
        
          
            <li>
              <a href="https://ricardoleal20.github.io/Blog/posts/heat_1d/heat_1d/">Solving the heat equation in 1D.</a>
            </li>
          
        
          
            <li>
              <a href="https://ricardoleal20.github.io/Blog/posts/epidemic/epidemic/">Modeling an epidemic.</a>
            </li>
          
        
          
            <li>
              <a href="https://ricardoleal20.github.io/Blog/posts/wave_membrane/wave_membrane/">Analysis of the tympanic membrane with the wave equation.</a>
            </li>
          
        
          
            <li>
              <a href="https://ricardoleal20.github.io/Blog/posts/traffic-flow/traffic-flow/">Simulating the traffic flow with Python.</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
      </footer>
    </article>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
          2020 -
        
        2021
         Ricardo M. Leal Lopez 
      
      
      
        
        
    </section>
  </footer>  

<script src="https://ricardoleal20.github.io/Blog/js/particles.js"></script>

    </main>

    
      
        
        <script src="https://ricardoleal20.github.io/Blog/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js"></script>
      
    

    
      <script src="https://ricardoleal20.github.io/Blog/js/particles.js"></script>
    
      <script src="https://ricardoleal20.github.io/Blog/js/app.js"></script>
    

    

    

    

    

    

    

    
  </body>

</html>
